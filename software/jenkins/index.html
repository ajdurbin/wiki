<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  <link rel="shortcut icon" href="../../img/favicon.ico">
  <title>Jenkins - Alex's Personal Wiki</title>
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="../../css/highlight.css">
  
  <script>
    // Current page data
    var mkdocs_page_name = "Jenkins";
    var mkdocs_page_input_path = "software/jenkins.md";
    var mkdocs_page_url = "/software/jenkins/";
  </script>
  
  <script src="../../js/jquery-2.1.1.min.js"></script>
  <script src="../../js/modernizr-2.8.3.min.js"></script>
  <script type="text/javascript" src="../../js/highlight.pack.js"></script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href="../.." class="icon icon-home"> Alex's Personal Wiki</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
	<ul class="current">
	  
          
            <li class="toctree-l1">
		
    <a class="" href="../..">Home</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../../books/">Books</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../../websites/">Websites</a>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Bash</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../bash/git/">Git</a>
                </li>
                <li class="">
                    
    <a class="" href="../../bash/regex/">Regex</a>
                </li>
                <li class="">
                    
    <a class="" href="../../bash/snippets/">Snippets</a>
                </li>
                <li class="">
                    
    <a class="" href="../../bash/tools/">Tools</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Deep learning</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../deep_learning/scratch/">Scratch</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Installation</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../installation/bittorrent_sync/">Bittorrent sync</a>
                </li>
                <li class="">
                    
    <a class="" href="../../installation/freenas/">Freenas</a>
                </li>
                <li class="">
                    
    <a class="" href="../../installation/pfsense/">Pfsense</a>
                </li>
                <li class="">
                    
    <a class="" href="../../installation/proxmox/">Proxmox</a>
                </li>
                <li class="">
                    
    <a class="" href="../../installation/raspberry_pi/">Raspberry pi</a>
                </li>
                <li class="">
                    
    <a class="" href="../../installation/torrent_server/">Torrent server</a>
                </li>
                <li class="">
                    
    <a class="" href="../../installation/ubuntu/">Ubuntu</a>
                </li>
                <li class="">
                    
    <a class="" href="../../installation/windows_10/">Windows 10</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Machine learning</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../machine_learning/methods/">Methods</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Natural language processing</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../natural_language_processing/scratch/">Scratch</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Python</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../python/environments/">Environments</a>
                </li>
                <li class="">
                    
    <a class="" href="../../python/packages/">Packages</a>
                </li>
                <li class="">
                    
    <a class="" href="../../python/scratch/">Scratch</a>
                </li>
                <li class="">
                    
    <a class="" href="../../python/snippets/">Snippets</a>
                </li>
                <li class="">
                    
    <span class="caption-text">Sklearn</span>
    <ul class="subnav">
                <li class="toctree-l3">
                    
    <a class="" href="../../python/sklearn/snippets/">Snippets</a>
                </li>
    </ul>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Software</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../artifactory/">Artifactory</a>
                </li>
                <li class="">
                    
    <a class="" href="../bittorrent_sync/">Bittorrent sync</a>
                </li>
                <li class="">
                    
    <a class="" href="../calibre/">Calibre</a>
                </li>
                <li class="">
                    
    <a class="" href="../ci_cd/">Ci cd</a>
                </li>
                <li class="">
                    
    <a class="" href="../docker/">Docker</a>
                </li>
                <li class="">
                    
    <a class="" href="../emby/">Emby</a>
                </li>
                <li class="">
                    
    <a class="" href="../gitea/">Gitea</a>
                </li>
                <li class="">
                    
    <a class="" href="../gogs/">Gogs</a>
                </li>
                <li class="">
                    
    <a class="" href="../ideas/">Ideas</a>
                </li>
                <li class=" current">
                    
    <a class="current" href="./">Jenkins</a>
    <ul class="subnav">
            
    <li class="toctree-l3"><a href="#installation">Installation</a></li>
    

    <li class="toctree-l3"><a href="#sample-jenkinsfiles">Sample Jenkinsfiles</a></li>
    

    </ul>
                </li>
                <li class="">
                    
    <a class="" href="../jupyterhub/">Jupyterhub</a>
                </li>
                <li class="">
                    
    <a class="" href="../mkdocs/">Mkdocs</a>
                </li>
                <li class="">
                    
    <a class="" href="../nbviewer/">Nbviewer</a>
                </li>
                <li class="">
                    
    <a class="" href="../nexus_repository/">Nexus repository</a>
                </li>
                <li class="">
                    
    <a class="" href="../plex/">Plex</a>
                </li>
                <li class="">
                    
    <a class="" href="../rclone/">Rclone</a>
                </li>
                <li class="">
                    
    <a class="" href="../reverse_proxy/">Reverse proxy</a>
                </li>
                <li class="">
                    
    <a class="" href="../rstudio_rshiny/">Rstudio rshiny</a>
                </li>
                <li class="">
                    
    <a class="" href="../torrent_server/">Torrent server</a>
                </li>
                <li class="">
                    
    <a class="" href="../travis-ci/">Travis ci</a>
                </li>
                <li class="">
                    
    <span class="caption-text">Docker</span>
    <ul class="subnav">
                <li class="toctree-l3">
                    
    <a class="" href="../docker/general_use/">General use</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../docker/installation/">Installation</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../docker/jenkins/">Jenkins</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../docker/registry/">Registry</a>
                </li>
    </ul>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Statistics</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../statistics/scratch/">Scratch</a>
                </li>
    </ul>
	    </li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../..">Alex's Personal Wiki</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../..">Docs</a> &raquo;</li>
    
      
        
          <li>Software &raquo;</li>
        
      
    
    <li>Jenkins</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h3 id="installation">Installation</h3>
<p>Following documentation at <code>https://jenkins.io/doc/book/installing/</code>, create a new container with 50GB storage and 1GB memory. Follow Ubuntu instructions on the documentation</p>
<pre><code>wget -q -O - https://pkg.jenkins.io/debian/jenkins.io.key | sudo apt-key add -
sudo sh -c 'echo deb http://pkg.jenkins.io/debian-stable binary/ &gt; /etc/apt/sources.list.d/jenkins.list'
sudo apt-get update
sudo apt-get install jenkins
</code></pre>

<p>Then go to <code>http://jenkinsip:8080</code> to finish the installation. Grab the Jenkins password from <code>/var/jenkins_home/secrets/initialAdminPassword</code>, choose install suggested plugins, and then create first administrator user with username alex. </p>
<ul>
<li>https://jenkins.io/doc/book/pipeline/docker/</li>
<li>https://go.cloudbees.com/docs/cloudbees-documentation/cje-user-guide/index.html#docker-workflow</li>
<li>https://getintodevops.com/blog/building-your-first-docker-image-with-jenkins-2-guide-for-developers</li>
<li>http://www.littlebigextra.com/using-jenkins-to-build-and-deploy-docker-images/</li>
<li>https://stackoverflow.com/questions/48769362/jenkins-pipeline-should-is-removing-container-on-remote-daemon-after-deployment</li>
<li>https://blog.philipphauer.de/tutorial-continuous-delivery-with-docker-jenkins/</li>
<li>https://www.digitalocean.com/community/tutorials/how-to-set-up-continuous-integration-pipelines-in-jenkins-on-ubuntu-16-04</li>
<li>https://www.thepolyglotdeveloper.com/2017/04/continuous-deployment-of-web-application-containers-with-jenkins-and-docker/</li>
<li>https://docs.docker.com/registry/deploying/#run-a-local-registry</li>
<li>https://jenkins.io/doc/book/pipeline/docker/</li>
</ul>
<h3 id="sample-jenkinsfiles">Sample Jenkinsfiles</h3>
<p>Ideal workflow is to build on the remote docker server, push to artifactory the built image, and then pull that new image to the docker server all from jenkins. </p>
<p>Something like:</p>
<pre><code> stage {
            steps {
                     script {
                               docker.withServer('tcp://10.10.10.10:2375') {
                               docker.withRegistry('https://registry.my.com/','jenkins-registry') {
                               docker.image('registry.my.com/image-my/my:latest').run(' -p 9090:80 -i -t --name harpal ') 

    }
                           }
                   }
            }
</code></pre>

<p>So first we would need to build the image with the server and with the registry to push it. From here we then pull the image and then rerun with server. </p>
<p>From work: </p>
<pre><code>node {

    checkout scm



    stage('Build')

    {   

        docker.withRegistry('artifactory', 'credentials')

        {

            def prdImage = docker.build(&quot;project/repository&quot;)



            prdImage.push(&quot;latest&quot;)

        }

    }

    stage('Test / Deploy')

    {

        marathon(

            url: &quot;${env.MARATHON_ENDPOINT}&quot;,

            forceUpdate: true,

            id: '/service_name/branch',

            definitionFile: 'marathon.json')



                def restart_uri = &quot;/v2/apps/service_name/branch/restart&quot;

                def reponse = httpRequest acceptType: 'APPLICATION_JSON', ignoreSslErrors: true, contentType: 'APPLICATION_JSON', httpMode: 'POST', requestBody: '{&quot;force&quot;:false}', url: &quot;${env.MARATHON_ENDPOINT}&quot; + restart_uri

    }

}



node {

    checkout scm



    // Define job specific variables

    def IMAGE = &quot;project/repository&quot;

    def REPOSITORY = &quot;repository.example.com&quot;

    def SERVICE_NAME = '/service/name/api'

    def BUILD_TAG = &quot;latest&quot;



    def prdImage = &quot;&quot;



    stage('Build')

    {  

        prdImage = docker.build(IMAGE)

    }

    stage('Test')

    {

        // Test cases needed

    }

    stage(&quot;Push&quot;)

    {

        docker.withRegistry('https://' + REPOSITORY, 'credentials')

        {

            prdImage.push(BUILD_TAG)

        }

    }

    stage('Deploy App')

    {

        marathon(

            url: &quot;${env.MARATHON_ENDPOINT}&quot;,

            forceUpdate: true,

            id: SERVICE_NAME,

            filename: 'marathon.json',

            docker: REPOSITORY + &quot;/&quot; + IMAGE + &quot;:&quot; + BUILD_TAG,

            dockerForcePull: true)



        try {

            def restart_uri = &quot;/v2/apps&quot; + SERVICE_NAME + &quot;/restart&quot;

            def response = httpRequest acceptType: 'APPLICATION_JSON', contentType: 'APPLICATION_JSON', httpMode: 'POST', ignoreSslErrors: true, requestBody: '{&quot;force&quot;:false}' , url: &quot;${env.MARATHON_ENDPOINT}&quot; + restart_uri

        }

        catch (exc) {

            echo 'Service restart failed, perhaps there was nothing to restart.'

        }



    }

    stage(&quot;Deploy Autoscaler&quot;)

    {

        marathon(

            url: &quot;${env.MARATHON_ENDPOINT}&quot;,

            forceUpdate: true,

            filename: 'autoscaler.json',

            dockerForcePull: true)

    }

    stage(&quot;Deploy Redis&quot;)

    {

        marathon(

            url: &quot;${env.MARATHON_ENDPOINT}&quot;,

            forceUpdate: true,

            filename: 'redis.json',

            dockerForcePull: true)

    }

}



node {

    checkout scm



    // Define job specific variables

    def IMAGE = &quot;repo/service-name&quot;

                def REPOSITORY = &quot;artifactory.example.com&quot;

    def BUILD_TAG = &quot;prd_${env.BUILD_ID}&quot;

    def SERVICE_NAME = '/service_name'



    stage('Build')

    {   

        docker.withRegistry('https://' + REPOSITORY, 'credentials')

        {

            def prdImage = docker.build(IMAGE)



            prdImage.push(BUILD_TAG)

            prdImage.push(&quot;latest&quot;)

        }

    }

    stage('Test / Deploy')

    {

        marathon(

            url: &quot;${env.MARATHON_ENDPOINT}&quot;,

            forceUpdate: true,

            id: SERVICE_NAME,

            definitionFile: 'marathon.json',

            docker: REPOSITORY + &quot;/&quot; + IMAGE + &quot;:&quot; + BUILD_TAG,

            dockerForcePull: true)

    }

}

node {

    checkout scm



    stage('Build')

    {   

        docker.withRegistry('https://artifactory.com', 'credentials')

        {

            def prdImage = docker.build(&quot;brach/service_name&quot;)



            prdImage.push(&quot;latest&quot;)

        }

    }

                # will need to translate above to docker.buidlwithserver then with registry push then with registry pull and redeploy for my environment

                # dont need marathon parts

    stage('Test / Deploy')

    {

        marathon(

            url: &quot;${env.MARATHON_ENDPOINT}&quot;,

            forceUpdate: true,

            id: '/kafka-to-cassandra/prd',

            definitionFile: 'marathon.json')



                def restart_uri = &quot;/v2/apps/service_name/branch/restart&quot;

                def reponse = httpRequest acceptType: 'APPLICATION_JSON', ignoreSslErrors: true, contentType: 'APPLICATION_JSON', httpMode: 'POST', requestBody: '{&quot;force&quot;:false}', url: &quot;${env.MARATHON_ENDPOINT}&quot; + restart_uri

    }

}
</code></pre>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../jupyterhub/" class="btn btn-neutral float-right" title="Jupyterhub">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../ideas/" class="btn btn-neutral" title="Ideas"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
      
        <span><a href="../ideas/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../jupyterhub/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script>var base_url = '../..';</script>
    <script src="../../js/theme.js"></script>
      <script src="../../search/require.js"></script>
      <script src="../../search/search.js"></script>

</body>
</html>
